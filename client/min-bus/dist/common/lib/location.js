'use strict';

var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; };

/**
 * copy from https://github.com/wandergis/coordtransform
 * Created by Wandergis on 2015/7/8.
 * 提供了百度坐标（BD09）、国测局坐标（火星坐标，GCJ02）、和WGS84坐标系之间的转换
 */
//UMD魔法代码
// if the module has no dependencies, the above pattern can be simplified to
(function (root, factory) {
  if (typeof define === 'function' && define.amd) {
    // AMD. Register as an anonymous module.
    define([], factory);
  } else if ((typeof module === 'undefined' ? 'undefined' : _typeof(module)) === 'object' && module.exports) {
    // Node. Does not work with strict CommonJS, but
    // only CommonJS-like environments that support module.exports,
    // like Node.
    module.exports = factory();
  } else {
    // Browser globals (root is window)
    root.coordtransform = factory();
  }
})(undefined, function () {
  //定义一些常量
  var x_PI = 3.14159265358979324 * 3000.0 / 180.0;
  var PI = 3.1415926535897932384626;
  var a = 6378245.0;
  var ee = 0.00669342162296594323;
  /**
   * 百度坐标系 (BD-09) 与 火星坐标系 (GCJ-02)的转换
   * 即 百度 转 谷歌、高德
   * @param bd_lon
   * @param bd_lat
   * @returns {*[]}
   */
  var bd09togcj02 = function bd09togcj02(bd_lon, bd_lat) {
    var bd_lon = +bd_lon;
    var bd_lat = +bd_lat;
    var x = bd_lon - 0.0065;
    var y = bd_lat - 0.006;
    var z = Math.sqrt(x * x + y * y) - 0.00002 * Math.sin(y * x_PI);
    var theta = Math.atan2(y, x) - 0.000003 * Math.cos(x * x_PI);
    var gg_lng = z * Math.cos(theta);
    var gg_lat = z * Math.sin(theta);
    return [gg_lng, gg_lat];
  };

  /**
   * 火星坐标系 (GCJ-02) 与百度坐标系 (BD-09) 的转换
   * 即谷歌、高德 转 百度
   * @param lng
   * @param lat
   * @returns {*[]}
   */
  var gcj02tobd09 = function gcj02tobd09(lng, lat) {
    var lat = +lat;
    var lng = +lng;
    var z = Math.sqrt(lng * lng + lat * lat) + 0.00002 * Math.sin(lat * x_PI);
    var theta = Math.atan2(lat, lng) + 0.000003 * Math.cos(lng * x_PI);
    var bd_lng = z * Math.cos(theta) + 0.0065;
    var bd_lat = z * Math.sin(theta) + 0.006;
    return [bd_lng, bd_lat];
  };

  /**
   * WGS84转GCj02
   * @param lng
   * @param lat
   * @returns {*[]}
   */
  var wgs84togcj02 = function wgs84togcj02(lng, lat) {
    var lat = +lat;
    var lng = +lng;
    if (out_of_china(lng, lat)) {
      return [lng, lat];
    } else {
      var dlat = transformlat(lng - 105.0, lat - 35.0);
      var dlng = transformlng(lng - 105.0, lat - 35.0);
      var radlat = lat / 180.0 * PI;
      var magic = Math.sin(radlat);
      magic = 1 - ee * magic * magic;
      var sqrtmagic = Math.sqrt(magic);
      dlat = dlat * 180.0 / (a * (1 - ee) / (magic * sqrtmagic) * PI);
      dlng = dlng * 180.0 / (a / sqrtmagic * Math.cos(radlat) * PI);
      var mglat = lat + dlat;
      var mglng = lng + dlng;
      return [mglng, mglat];
    }
  };

  /**
   * GCJ02 转换为 WGS84
   * @param lng
   * @param lat
   * @returns {*[]}
   */
  var gcj02towgs84 = function gcj02towgs84(lng, lat) {
    var lat = +lat;
    var lng = +lng;
    if (out_of_china(lng, lat)) {
      return [lng, lat];
    } else {
      var dlat = transformlat(lng - 105.0, lat - 35.0);
      var dlng = transformlng(lng - 105.0, lat - 35.0);
      var radlat = lat / 180.0 * PI;
      var magic = Math.sin(radlat);
      magic = 1 - ee * magic * magic;
      var sqrtmagic = Math.sqrt(magic);
      dlat = dlat * 180.0 / (a * (1 - ee) / (magic * sqrtmagic) * PI);
      dlng = dlng * 180.0 / (a / sqrtmagic * Math.cos(radlat) * PI);
      var mglat = lat + dlat;
      var mglng = lng + dlng;
      return [lng * 2 - mglng, lat * 2 - mglat];
    }
  };

  var transformlat = function transformlat(lng, lat) {
    var lat = +lat;
    var lng = +lng;
    var ret = -100.0 + 2.0 * lng + 3.0 * lat + 0.2 * lat * lat + 0.1 * lng * lat + 0.2 * Math.sqrt(Math.abs(lng));
    ret += (20.0 * Math.sin(6.0 * lng * PI) + 20.0 * Math.sin(2.0 * lng * PI)) * 2.0 / 3.0;
    ret += (20.0 * Math.sin(lat * PI) + 40.0 * Math.sin(lat / 3.0 * PI)) * 2.0 / 3.0;
    ret += (160.0 * Math.sin(lat / 12.0 * PI) + 320 * Math.sin(lat * PI / 30.0)) * 2.0 / 3.0;
    return ret;
  };

  var transformlng = function transformlng(lng, lat) {
    var lat = +lat;
    var lng = +lng;
    var ret = 300.0 + lng + 2.0 * lat + 0.1 * lng * lng + 0.1 * lng * lat + 0.1 * Math.sqrt(Math.abs(lng));
    ret += (20.0 * Math.sin(6.0 * lng * PI) + 20.0 * Math.sin(2.0 * lng * PI)) * 2.0 / 3.0;
    ret += (20.0 * Math.sin(lng * PI) + 40.0 * Math.sin(lng / 3.0 * PI)) * 2.0 / 3.0;
    ret += (150.0 * Math.sin(lng / 12.0 * PI) + 300.0 * Math.sin(lng / 30.0 * PI)) * 2.0 / 3.0;
    return ret;
  };

  /**
   * 判断是否在国内，不在国内则不做偏移
   * @param lng
   * @param lat
   * @returns {boolean}
   */
  var out_of_china = function out_of_china(lng, lat) {
    var lat = +lat;
    var lng = +lng;
    // 纬度3.86~53.55,经度73.66~135.05 
    return !(lng > 73.66 && lng < 135.05 && lat > 3.86 && lat < 53.55);
  };

  return {
    bd09togcj02: bd09togcj02,
    gcj02tobd09: gcj02tobd09,
    wgs84togcj02: wgs84togcj02,
    gcj02towgs84: gcj02towgs84
  };
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxvY2F0aW9uLmpzIl0sIm5hbWVzIjpbInJvb3QiLCJmYWN0b3J5IiwiZGVmaW5lIiwiYW1kIiwibW9kdWxlIiwiZXhwb3J0cyIsImNvb3JkdHJhbnNmb3JtIiwieF9QSSIsIlBJIiwiYSIsImVlIiwiYmQwOXRvZ2NqMDIiLCJiZF9sb24iLCJiZF9sYXQiLCJ4IiwieSIsInoiLCJNYXRoIiwic3FydCIsInNpbiIsInRoZXRhIiwiYXRhbjIiLCJjb3MiLCJnZ19sbmciLCJnZ19sYXQiLCJnY2owMnRvYmQwOSIsImxuZyIsImxhdCIsImJkX2xuZyIsIndnczg0dG9nY2owMiIsIm91dF9vZl9jaGluYSIsImRsYXQiLCJ0cmFuc2Zvcm1sYXQiLCJkbG5nIiwidHJhbnNmb3JtbG5nIiwicmFkbGF0IiwibWFnaWMiLCJzcXJ0bWFnaWMiLCJtZ2xhdCIsIm1nbG5nIiwiZ2NqMDJ0b3dnczg0IiwicmV0IiwiYWJzIl0sIm1hcHBpbmdzIjoiOzs7O0FBQUE7Ozs7O0FBS0E7QUFDQTtBQUNDLFdBQVVBLElBQVYsRUFBZ0JDLE9BQWhCLEVBQXlCO0FBQ3hCLE1BQUksT0FBT0MsTUFBUCxLQUFrQixVQUFsQixJQUFnQ0EsT0FBT0MsR0FBM0MsRUFBZ0Q7QUFDOUM7QUFDQUQsV0FBTyxFQUFQLEVBQVdELE9BQVg7QUFDRCxHQUhELE1BR08sSUFBSSxRQUFPRyxNQUFQLHlDQUFPQSxNQUFQLE9BQWtCLFFBQWxCLElBQThCQSxPQUFPQyxPQUF6QyxFQUFrRDtBQUN2RDtBQUNBO0FBQ0E7QUFDQUQsV0FBT0MsT0FBUCxHQUFpQkosU0FBakI7QUFDRCxHQUxNLE1BS0E7QUFDTDtBQUNBRCxTQUFLTSxjQUFMLEdBQXNCTCxTQUF0QjtBQUNEO0FBQ0YsQ0FiQSxhQWFPLFlBQVk7QUFDbEI7QUFDQSxNQUFJTSxPQUFPLHNCQUFzQixNQUF0QixHQUErQixLQUExQztBQUNBLE1BQUlDLEtBQUssd0JBQVQ7QUFDQSxNQUFJQyxJQUFJLFNBQVI7QUFDQSxNQUFJQyxLQUFLLHNCQUFUO0FB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QUFjQSxZQUhUO0FBSUxXLGtCQUFjQTtBQUpULEdBQVA7QUFNRCxDQWxKQSxDQUFEIiwiZmlsZSI6ImxvY2F0aW9uLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqIGNvcHkgZnJvbSBodHRwczovL2dpdGh1Yi5jb20vd2FuZGVyZ2lzL2Nvb3JkdHJhbnNmb3JtXHJcbiAqIENyZWF0ZWQgYnkgV2FuZGVyZ2lzIG9uIDIwMTUvNy84LlxyXG4gKiDmj5Dkvpvkuobnmb7luqblnZDmoIfvvIhCRDA577yJ44CB5Zu95rWL5bGA5Z2Q5qCH77yI54Gr5pif5Z2Q5qCH77yMR0NKMDLvvInjgIHlkoxXR1M4NOWdkOagh+ezu+S5i+mXtOeahOi9rOaNolxyXG4gKi9cclxuLy9VTUTprZTms5Xku6PnoIFcclxuLy8gaWYgdGhlIG1vZHVsZSBoYXMgbm8gZGVwZW5kZW5jaWVzLCB0aGUgYWJvdmUgcGF0dGVybiBjYW4gYmUgc2ltcGxpZmllZCB0b1xyXG4oZnVuY3Rpb24gKHJvb3QsIGZhY3RvcnkpIHtcclxuICBpZiAodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKSB7XHJcbiAgICAvLyBBTUQuIFJlZ2lzdGVyIGFzIGFuIGFub255bW91cyBtb2R1bGUuXHJcbiAgICBkZWZpbmUoW10sIGZhY3RvcnkpO1xyXG4gIH0gZWxzZSBpZiAodHlwZW9mIG1vZHVsZSA9PT0gJ29iamVjdCcgJiYgbW9kdWxlLmV4cG9ydHMpIHtcclxuICAgIC8vIE5vZGUuIERvZXMgbm90IHdvcmsgd2l0aCBzdHJpY3QgQ29tbW9uSlMsIGJ1dFxyXG4gICAgLy8gb25seSBDb21tb25KUy1saWtlIGVudmlyb25tZW50cyB0aGF0IHN1cHBvcnQgbW9kdWxlLmV4cG9ydHMsXHJcbiAgICAvLyBsaWtlIE5vZGUuXHJcbiAgICBtb2R1bGUuZXhwb3J0cyA9IGZhY3RvcnkoKTtcclxuICB9IGVsc2Uge1xyXG4gICAgLy8gQnJvd3NlciBnbG9iYWxzIChyb290IGlzIHdpbmRvdylcclxuICAgIHJvb3QuY29vcmR0cmFuc2Zvcm0gPSBmYWN0b3J5KCk7XHJcbiAgfVxyXG59KHRoaXMsIGZ1bmN0aW9uICgpIHtcclxuICAvL+WumuS5ieS4gOS6m+W4uOmHj1xyXG4gIHZhciB4X1BJID0gMy4xNDE1OTI2NTM1ODk3OTMyNCAqIDMwMDAuMCAvIDE4MC4wO1xyXG4gIHZhciBQSSA9IDMuMTQxNTkyNjUzNTg5NzkzMjM4NDYyNjtcclxuICB2YXIgYSA9IDYzNzgyNDUuMDtcclxuICB2YXIgZWUgPSAwLjAwNjY5MzQyMTYyMjk2NTk0MzIzO1xyXG4gIC8qKlxyXG4gICAqIOeZvuW6puWdkOagh+ezuyAoQkQtMDkpIOS4jiDngavmmJ/lnZDmoIfns7sgKEdDSi0wMinnmoTovazmjaJcclxuICAgKiDljbMg55m+5bqmIOi9rCDosLfmrYzjgIHpq5jlvrdcclxuICAgKiBAcGFyYW0gYmRfbG9uXHJcbiAgICogQHBhcmFtIGJkX2xhdFxyXG4gICAqIEByZXR1cm5zIHsqW119XHJcbiAgICovXHJcbiAgdmFyIGJkMDl0b2djajAyID0gZnVuY3Rpb24gYmQwOXRvZ2NqMDIgKGJkX2xvbiwgYmRfbGF0KSB7XHJcbiAgICB2YXIgYmRfbG9uID0gK2JkX2xvbjtcclxuICAgIHZhciBiZF9sYXQgPSArYmRfbGF0O1xyXG4gICAgdmFyIHggPSBiZF9sb24gLSAwLjAwNjU7XHJcbiAgICB2YXIgeSA9IGJkX2xhdCAtIDAuMDA2O1xyXG4gICAgdmFyIHogPSBNYXRoLnNxcnQoeCAqIHggKyB5ICogeSkgLSAwLjAwMDAyICogTWF0aC5zaW4oeSAqIHhfUEkpO1xyXG4gICAgdmFyIHRoZXRhID0gTWF0aC5hdGFuMih5LCB4KSAtIDAuMDAwMDAzICogTWF0aC5jb3MoeCAqIHhfUEkpO1xyXG4gICAgdmFyIGdnX2xuZyA9IHogKiBNYXRoLmNvcyh0aGV0YSk7XHJcbiAgICB2YXIgZ2dfbGF0ID0geiAqIE1hdGguc2luKHRoZXRhKTtcclxuICAgIHJldHVybiBbZ2dfbG5nLCBnZ19sYXRdXHJcbiAgfTtcclxuXHJcbiAgLyoqXHJcbiAgICog54Gr5pif5Z2Q5qCH57O7IChHQ0otMDIpIOS4jueZvuW6puWdkOagh+ezuyAoQkQtMDkpIOeahOi9rOaNolxyXG4gICAqIOWNs+iwt+atjOOAgemrmOW+tyDovawg55m+5bqmXHJcbiAgICogQHBhcmFtIGxuZ1xyXG4gICAqIEBwYXJhbSBsYXRcclxuICAgKiBAcmV0dXJucyB7KltdfVxyXG4gICAqL1xyXG4gIHZhciBnY2owMnRvYmQwOSA9IGZ1bmN0aW9uIGdjajAydG9iZDA5IChsbmcsIGxhdCkge1xyXG4gICAgdmFyIGxhdCA9ICtsYXQ7XHJcbiAgICB2YXIgbG5nID0gK2xuZztcclxuICAgIHZhciB6ID0gTWF0aC5zcXJ0KGxuZyAqIGxuZyArIGxhdCAqIGxhdCkgKyAwLjAwMDAyICogTWF0aC5zaW4obGF0ICogeF9QSSk7XHJcbiAgICB2YXIgdGhldGEgPSBNYXRoLmF0YW4yKGxhdCwgbG5nKSArIDAuMDAwMDAzICogTWF0aC5jb3MobG5nICogeF9QSSk7XHJcbiAgICB2YXIgYmRfbG5nID0geiAqIE1hdGguY29zKHRoZXRhKSArIDAuMDA2NTtcclxuICAgIHZhciBiZF9sYXQgPSB6ICogTWF0aC5zaW4odGhldGEpICsgMC4wMDY7XHJcbiAgICByZXR1cm4gW2JkX2xuZywgYmRfbGF0XVxyXG4gIH07XHJcblxyXG4gIC8qKlxyXG4gICAqIFdHUzg06L2sR0NqMDJcclxuICAgKiBAcGFyYW0gbG5nXHJcbiAgICogQHBhcmFtIGxhdFxyXG4gICAqIEByZXR1cm5zIHsqW119XHJcbiAgICovXHJcbiAgdmFyIHdnczg0dG9nY2owMiA9IGZ1bmN0aW9uIHdnczg0dG9nY2owMiAobG5nLCBsYXQpIHtcclxuICAgIHZhciBsYXQgPSArbGF0O1xyXG4gICAgdmFyIGxuZyA9ICtsbmc7XHJcbiAgICBpZiAob3V0X29mX2NoaW5hKGxuZywgbGF0KSkge1xyXG4gICAgICByZXR1cm4gW2xuZywgbGF0XVxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdmFyIGRsYXQgPSB0cmFuc2Zvcm1sYXQobG5nIC0gMTA1LjAsIGxhdCAtIDM1LjApO1xyXG4gICAgICB2YXIgZGxuZyA9IHRyYW5zZm9ybWxuZyhsbmcgLSAxMDUuMCwgbGF0IC0gMzUuMCk7XHJcbiAgICAgIHZhciByYWRsYXQgPSBsYXQgLyAxODAuMCAqIFBJO1xyXG4gICAgICB2YXIgbWFnaWMgPSBNYXRoLnNpbihyYWRsYXQpO1xyXG4gICAgICBtYWdpYyA9IDEgLSBlZSAqIG1hZ2ljICogbWFnaWM7XHJcbiAgICAgIHZhciBzcXJ0bWFnaWMgPSBNYXRoLnNxcnQobWFnaWMpO1xyXG4gICAgICBkbGF0ID0gKGRsYXQgKiAxODAuMCkgLyAoKGEgKiAoMSAtIGVlKSkgLyAobWFnaWMgKiBzcXJ0bWFnaWMpICogUEkpO1xyXG4gICAgICBkbG5nID0gKGRsbmcgKiAxODAuMCkgLyAoYSAvIHNxcnRtYWdpYyAqIE1hdGguY29zKHJhZGxhdCkgKiBQSSk7XHJcbiAgICAgIHZhciBtZ2xhdCA9IGxhdCArIGRsYXQ7XHJcbiAgICAgIHZhciBtZ2xuZyA9IGxuZyArIGRsbmc7XHJcbiAgICAgIHJldHVybiBbbWdsbmcsIG1nbGF0XVxyXG4gICAgfVxyXG4gIH07XHJcblxyXG4gIC8qKlxyXG4gICAqIEdDSjAyIOi9rOaNouS4uiBXR1M4NFxyXG4gICAqIEBwYXJhbSBsbmdcclxuICAgKiBAcGFyYW0gbGF0XHJcbiAgICogQHJldHVybnMgeypbXX1cclxuICAgKi9cclxuICB2YXIgZ2NqMDJ0b3dnczg0ID0gZnVuY3Rpb24gZ2NqMDJ0b3dnczg0IChsbmcsIGxhdCkge1xyXG4gICAgdmFyIGxhdCA9ICtsYXQ7XHJcbiAgICB2YXIgbG5nID0gK2xuZztcclxuICAgIGlmIChvdXRfb2ZfY2hpbmEobG5nLCBsYXQpKSB7XHJcbiAgICAgIHJldHVybiBbbG5nLCBsYXRdXHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB2YXIgZGxhdCA9IHRyYW5zZm9ybWxhdChsbmcgLSAxMDUuMCwgbGF0IC0gMzUuMCk7XHJcbiAgICAgIHZhciBkbG5nID0gdHJhbnNmb3JtbG5nKGxuZyAtIDEwNS4wLCBsYXQgLSAzNS4wKTtcclxuICAgICAgdmFyIHJhZGxhdCA9IGxhdCAvIDE4MC4wICogUEk7XHJcbiAgICAgIHZhciBtYWdpYyA9IE1hdGguc2luKHJhZGxhdCk7XHJcbiAgICAgIG1hZ2ljID0gMSAtIGVlICogbWFnaWMgKiBtYWdpYztcclxuICAgICAgdmFyIHNxcnRtYWdpYyA9IE1hdGguc3FydChtYWdpYyk7XHJcbiAgICAgIGRsYXQgPSAoZGxhdCAqIDE4MC4wKSAvICgoYSAqICgxIC0gZWUpKSAvIChtYWdpYyAqIHNxcnRtYWdpYykgKiBQSSk7XHJcbiAgICAgIGRsbmcgPSAoZGxuZyAqIDE4MC4wKSAvIChhIC8gc3FydG1hZ2ljICogTWF0aC5jb3MocmFkbGF0KSAqIFBJKTtcclxuICAgICAgdmFyIG1nbGF0ID0gbGF0ICsgZGxhdDtcclxuICAgICAgdmFyIG1nbG5nID0gbG5nICsgZGxuZztcclxuICAgICAgcmV0dXJuIFtsbmcgKiAyIC0gbWdsbmcsIGxhdCAqIDIgLSBtZ2xhdF1cclxuICAgIH1cclxuICB9O1xyXG5cclxuICB2YXIgdHJhbnNmb3JtbGF0ID0gZnVuY3Rpb24gdHJhbnNmb3JtbGF0IChsbmcsIGxhdCkge1xyXG4gICAgdmFyIGxhdCA9ICtsYXQ7XHJcbiAgICB2YXIgbG5nID0gK2xuZztcclxuICAgIHZhciByZXQgPSAtMTAwLjAgKyAyLjAgKiBsbmcgKyAzLjAgKiBsYXQgKyAwLjIgKiBsYXQgKiBsYXQgKyAwLjEgKiBsbmcgKiBsYXQgKyAwLjIgKiBNYXRoLnNxcnQoTWF0aC5hYnMobG5nKSk7XHJcbiAgICByZXQgKz0gKDIwLjAgKiBNYXRoLnNpbig2LjAgKiBsbmcgKiBQSSkgKyAyMC4wICogTWF0aC5zaW4oMi4wICogbG5nICogUEkpKSAqIDIuMCAvIDMuMDtcclxuICAgIHJldCArPSAoMjAuMCAqIE1hdGguc2luKGxhdCAqIFBJKSArIDQwLjAgKiBNYXRoLnNpbihsYXQgLyAzLjAgKiBQSSkpICogMi4wIC8gMy4wO1xyXG4gICAgcmV0ICs9ICgxNjAuMCAqIE1hdGguc2luKGxhdCAvIDEyLjAgKiBQSSkgKyAzMjAgKiBNYXRoLnNpbihsYXQgKiBQSSAvIDMwLjApKSAqIDIuMCAvIDMuMDtcclxuICAgIHJldHVybiByZXRcclxuICB9O1xyXG5cclxuICB2YXIgdHJhbnNmb3JtbG5nID0gZnVuY3Rpb24gdHJhbnNmb3JtbG5nIChsbmcsIGxhdCkge1xyXG4gICAgdmFyIGxhdCA9ICtsYXQ7XHJcbiAgICB2YXIgbG5nID0gK2xuZztcclxuICAgIHZhciByZXQgPSAzMDAuMCArIGxuZyArIDIuMCAqIGxhdCArIDAuMSAqIGxuZyAqIGxuZyArIDAuMSAqIGxuZyAqIGxhdCArIDAuMSAqIE1hdGguc3FydChNYXRoLmFicyhsbmcpKTtcclxuICAgIHJldCArPSAoMjAuMCAqIE1hdGguc2luKDYuMCAqIGxuZyAqIFBJKSArIDIwLjAgKiBNYXRoLnNpbigyLjAgKiBsbmcgKiBQSSkpICogMi4wIC8gMy4wO1xyXG4gICAgcmV0ICs9ICgyMC4wICogTWF0aC5zaW4obG5nICogUEkpICsgNDAuMCAqIE1hdGguc2luKGxuZyAvIDMuMCAqIFBJKSkgKiAyLjAgLyAzLjA7XHJcbiAgICByZXQgKz0gKDE1MC4wICogTWF0aC5zaW4obG5nIC8gMTIuMCAqIFBJKSArIDMwMC4wICogTWF0aC5zaW4obG5nIC8gMzAuMCAqIFBJKSkgKiAyLjAgLyAzLjA7XHJcbiAgICByZXR1cm4gcmV0XHJcbiAgfTtcclxuXHJcbiAgLyoqXHJcbiAgICog5Yik5pat5piv5ZCm5Zyo5Zu95YaF77yM5LiN5Zyo5Zu95YaF5YiZ5LiN5YGa5YGP56e7XHJcbiAgICogQHBhcmFtIGxuZ1xyXG4gICAqIEBwYXJhbSBsYXRcclxuICAgKiBAcmV0dXJucyB7Ym9vbGVhbn1cclxuICAgKi9cclxuICB2YXIgb3V0X29mX2NoaW5hID0gZnVuY3Rpb24gb3V0X29mX2NoaW5hIChsbmcsIGxhdCkge1xyXG4gICAgdmFyIGxhdCA9ICtsYXQ7XHJcbiAgICB2YXIgbG5nID0gK2xuZztcclxuICAgIC8vIOe6rOW6pjMuODZ+NTMuNTUs57uP5bqmNzMuNjZ+MTM1LjA1IFxyXG4gICAgcmV0dXJuICEobG5nID4gNzMuNjYgJiYgbG5nIDwgMTM1LjA1ICYmIGxhdCA+IDMuODYgJiYgbGF0IDwgNTMuNTUpO1xyXG4gIH07XHJcblxyXG4gIHJldHVybiB7XHJcbiAgICBiZDA5dG9nY2owMjogYmQwOXRvZ2NqMDIsXHJcbiAgICBnY2owMnRvYmQwOTogZ2NqMDJ0b2JkMDksXHJcbiAgICB3Z3M4NHRvZ2NqMDI6IHdnczg0dG9nY2owMixcclxuICAgIGdjajAydG93Z3M4NDogZ2NqMDJ0b3dnczg0XHJcbiAgfVxyXG59KSk7Il19